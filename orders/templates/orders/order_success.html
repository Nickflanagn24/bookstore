{% extends 'base.html' %}
{% load static %}

{% block title %}Order Confirmation - Tales & Tails{% endblock %}

{% block content %}
<div class="container mt-5 mb-5">
    <div class="row justify-content-center">
        <div class="col-lg-8">
            <div class="success-container bg-white p-5 rounded shadow">
                <!-- Success Header -->
                <div class="text-center mb-4">
                    <div class="success-icon mb-3">
                        <i class="fas fa-check-circle text-success" style="font-size: 4rem;"></i>
                    </div>
                    <h1 class="text-success mb-3">Payment Successful!</h1>
                    <p class="lead text-muted">
                        Thank you for your order. Your payment has been processed successfully 
                        and your order is now confirmed.
                    </p>
                </div>

                <!-- Order Summary Card -->
                <div class="order-summary bg-light p-4 rounded mb-4">
                    <div class="order-header d-flex justify-content-between align-items-center mb-4 pb-3 border-bottom">
                        <div>
                            <div class="order-number h4 text-primary mb-1">Order #{{ order.order_number }}</div>
                            <div class="order-date text-muted">{{ order.created_at|date:"F d, Y at g:i A" }}</div>
                        </div>
                        <div>
                            <span class="badge bg-success fs-6 px-3 py-2">{{ order.status|title }}</span>
                        </div>
                    </div>

                    <!-- Customer Info -->
                    <div class="customer-info bg-primary bg-opacity-10 p-3 rounded mb-4">
                        <div class="info-title fw-bold text-primary mb-2">Order Details</div>
                        <div class="row">
                            <div class="col-md-6">
                                <strong>Customer:</strong> {{ order.customer_full_name }}<br>
                                <strong>Email:</strong> {{ order.customer_email }}
                            </div>
                            <div class="col-md-6">
                                <strong>Payment Status:</strong> <span class="text-success">{{ order.payment_status|title }}</span>
                            </div>
                        </div>
                    </div>

                    <!-- Order Items -->
                    <h5 class="mb-3">Items Ordered:</h5>
                    {% for item in order_items %}
                    <div class="order-item d-flex justify-content-between align-items-center py-3 border-bottom">
                        <div class="item-details flex-grow-1">
                            <div class="item-title fw-bold mb-1">{{ item.book_title }}</div>
                            <div class="item-author text-muted">by {{ item.book_authors }}</div>
                        </div>
                        <div class="item-quantity text-muted mx-3">
                            <span class="badge bg-light text-dark">Qty: {{ item.quantity }}</span>
                        </div>
                        <div class="item-price fw-bold text-primary">£{{ item.total_price|floatformat:2 }}</div>
                    </div>
                    {% endfor %}

                    <!-- Order Totals -->
                    <div class="order-totals border-top pt-3 mt-3">
                        {% with subtotal=order.total_price shipping=5.00 %}
                        <div class="d-flex justify-content-between mb-2">
                            <span>Subtotal:</span>
                            <span>£{{ subtotal|floatformat:2 }}</span>
                        </div>
                        <div class="d-flex justify-content-between mb-2">
                            <span>Shipping:</span>
                            <span>£{{ shipping|floatformat:2 }}</span>
                        </div>
                        <div class="d-flex justify-content-between border-top pt-3 mt-3">
                            <span class="fw-bold h5">Total Paid:</span>
                            <span class="fw-bold h5 text-primary">£{{ order.total_amount|floatformat:2 }}</span>
                        </div>
                        {% endwith %}
                    </div>
                </div>

                <!-- Next Steps -->
                <div class="next-steps bg-warning bg-opacity-10 border border-warning p-4 rounded mb-4">
                    <h5 class="text-warning-emphasis mb-3">
                        <i class="fas fa-info-circle me-2"></i>What happens next?
                    </h5>
                    <ul class="text-warning-emphasis mb-0">
                        <li>You'll receive an order confirmation email shortly</li>
                        <li>Your order will be processed within 1-2 business days</li>
                        <li>You'll receive tracking information once your order ships</li>
                        <li>Delivery typically takes 3-5 business days</li>
                    </ul>
                </div>

                <!-- Action Buttons -->
                <div class="action-buttons text-center">
                    <a href="{% url 'orders:order_detail' order.order_number %}" class="btn btn-primary btn-lg me-3">
                        <i class="fas fa-eye me-2"></i>View Order Details
                    </a>
                    <a href="{% url 'books:book_list' %}" class="btn btn-outline-secondary btn-lg">
                        <i class="fas fa-book me-2"></i>Continue Shopping
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_css %}
<style>
    .success-container {
        background: white !important;
    }
    
    .order-item:last-child {
        border-bottom: none !important;
    }
    
    .badge {
        font-size: 0.9em;
    }
    
    .text-warning-emphasis {
        color: #664d03 !important;
    }
    
    .bg-warning {
        --bs-bg-opacity: 0.1;
    }
</style>
{% endblock %}
